hass_statistics:
  input_number:
    automations_triggers_counter:
      name: Automations Triggers Counter
      min: 0
      max: 999999
      step: 1

  sql:
    - name: Maria DB size
      db_url: !secret recorder_db_url
      query: >
        SELECT
          table_schema AS "database",
          ROUND(SUM(data_length + index_length) / POWER(1024, 2), 2) AS "value"
        FROM information_schema.tables
        WHERE table_schema = "homeassistant"
        GROUP BY table_schema;
      column: "value"
      unit_of_measurement: "MiB"
      device_class: data_size
      state_class: measurement

  template:
    - sensor:
        # ----- Count Automations
        - name: "Count Automations"
          unit_of_measurement: ""
          state: >-
            {{ states.automation | list | length }}

        # ----- Count Scripts
        - name: "Count Scripts"
          unit_of_measurement: ""
          state: >-
            {{ states.script | list | length }}

        # ----- Count Device Trackers
        - name: "Count Device Trackers"
          unit_of_measurement: ""
          state: >-
            {{ states.device_tracker | list | length }}

        # ----- Count Binary Sensors
        - name: "Count Binary Sensors"
          unit_of_measurement: ""
          state: >-
            {{ states.binary_sensor | list | length }}

        # ----- Count Sensors
        - name: "Count Sensors"
          unit_of_measurement: ""
          state: >-
            {{ states.sensor | list | length }}

        # ----- Count Switches
        - name: "Count Switches"
          unit_of_measurement: ""
          state: >-
            {{ states.switch | list | length }}

        # ----- Count Zones
        - name: "Count Zones"
          unit_of_measurement: ""
          state: >-
            {{ states.zone | list | length }}

        # ----- Input Booleans
        - name: "Count Input Booleans"
          unit_of_measurement: ""
          state: >-
            {{ states.input_boolean | list | length }}

        # ----- Input Numbers
        - name: "Count Input Numbers"
          unit_of_measurement: ""
          state: >-
            {{ states.input_number | list | length }}

        # ----- Input Texts
        - name: "Count Input Texts"
          unit_of_measurement: ""
          state: >-
            {{ states.input_text | list | length }}

        # ----- Input Selects
        - name: "Count Input Selects"
          unit_of_measurement: ""
          state: >-
            {{ states.input_select | list | length }}

        # ----- Input DateTimes
        - name: "Count Input Datetimes"
          unit_of_measurement: ""
          state: >-
            {{ states.input_datetime | list | length }}

        - name: "Unavailable Now Light"
          unit_of_measurement: ""
          state: >-
            {{ states.light | selectattr('state', 'equalto', 'unavailable') | list | length }}
          icon: mdi:counter

        - name: "Unavailable Now Switch"
          unit_of_measurement: ""
          state: >-
            {{ states.switch | selectattr('state', 'equalto', 'unavailable') | list | length }}
          icon: mdi:counter

        - name: "Unavailable Now Sensor"
          unit_of_measurement: ""
          state: >-
            {{ (states.sensor | selectattr('state', 'equalto', 'unavailable') | list | length) - 1 }}
          icon: mdi:counter

        - name: "Unavailable Now Binary Sensor"
          unit_of_measurement: ""
          state: >-
            {{ states.binary_sensor | selectattr('state', 'equalto', 'unavailable') | list | length }}
          icon: mdi:counter

  automation:
    - alias: "[HASS] Count Automation Trigger"
      trigger:
        - platform: event
          event_type: automation_triggered
      action:
        - service: input_number.set_value
          target:
            entity_id: input_number.automations_triggers_counter
          data:
            value: "{{ states('input_number.automations_triggers_counter') | int + 1 }}"

    - alias: "[HASS] Reset Automation Trigger Counter"
      trigger:
        - platform: time
          at: "00:00:00"
      action:
        - service: input_number.set_value
          target:
            entity_id: input_number.automations_triggers_counter
          data:
            value: "{{ 0 }}"
